var timer_vehicle,timer_location,info_login="",timer=[],ajax_139="",ajax_106="https://api0.youbanganda.com",arr_sign=1,myVideo=[],myVideo_small=[],get_localtion="";$(document).ajaxSuccess(function(e,t,n){var a=t.responseJSON;if(!(a&&a.hash||a&&a.token)&&(!a||0!=a.result)&&a&&"0000"!==a.code){if("1000"===a.code)return;toastr.success(a.message)}}),window.localStorage.info_login?(info_login=JSON.parse(window.localStorage.info_login),$("#login_name").html(info_login.data.realname),console.log(info_login)):(window.sessionStorage.sizeHtml=window.location.href,window.location.href="login.html");var map_style="amap://styles/0aec002a2cbb52a45552c91ecb520c5f",width_trajectory=4,colors_trajectory_default="#b4b1d7",colors_trajectory_checked=["#9bacc7","#b94b5b","#ee8754"];function clearTimer(){if(window.clearInterval(timer_location),0===timer.length)return!1;for(var e in timer)window.clearInterval(timer[e])}function fun_nav_begin(){var i=JSON.parse(info_login.data.display);"82"!=info_login.data.id&&(i=function(e){for(var t=0;t<i.length;t++){if(e==i[t].href)return i.splice(t,1),i;if(i[t].items)for(var n=i[t].items,a=0;a<n.length;a++)if(e==n[a].href)return n.splice(a,1),i}return i}("video-playback"));var a="";i.forEach(function(e,t){var n="";e.items&&0<e.items.length&&(n=JSON.stringify(e.items)),a+="<li><a class="+(0==t?"active":"default")+" d-href="+e.href+" d-child='"+n+"'>"+e.name+"</a></li>"}),$(".navBar-list").html(a)}function clear_storage(e){e&&0!==e.length||(e=["info_tab_unsafe","info_dataSingle","info_car"]),e.forEach(function(e,t){window.sessionStorage.removeItem(e)})}function ajax_nav(a,e){fn_breadcrumbs(null),window.clearInterval(timer_vehicle),"fence"!==a&&fn_sess_remove("fenceInfo");GetQueryString("sign");e||history.pushState({sign:a},"页面标题","index.html?sign="+a),JSON.parse(info_login.data.display).forEach(function(n,e){(n.href===a&&$("#w_tle").html("友邦BMS管理系统-"+n.name),n.items&&0!==n.items.length)&&n.items.forEach(function(e,t){e.href===a&&($("#w_tle").html("友邦BMS管理系统-"+e.name),fn_breadcrumbs([{name:n.name},{name:e.name}]))})}),1==get_localtion&&(get_localtion="0"),$(".navBar-tab").hide(),show_loading_bar(75),$.ajax({url:"html/"+a+".html",dataType:"html",async:!0,cache:!1,success:function(e){clearTimer(),$(".mainBlock").html(e),0<myVideo.length&&location.reload(),myVideo=[],myVideo_small=[],show_loading_bar({pct:100,finish:function(e){hide_loading_bar()}})}})}function loading_main(e){e.html("加载中……")}function ajax_logout(){$.ajax({url:ajax_139+"/api/user/logout.json",type:"post",dataType:"json"}).then(function(e){"0000"===e.code&&(window.location.href="login.html")})}function menu(o){var r={title:"",search:{display:!1,info:""},list:{display:!1,items:{id:"",name:""}},date:{display:!1,start:"",end:""},event:{display:!1,title:"事件",options:[]}},l='<div class="menu-title menu-height" id="menu_title">标题</div><div class="menu-content"><div class="menu-select menu-height zoom" id="menu_event"><div class="menu-select-title color999">请选择停车事件</div><select id="menu_event_select"></select></div><div class="menu-input menu-height menu_date"><input type="text" placeholder="请选择开始时间" id="menu_start" onclick=\'laydate.render({elem:this,type:"datetime",position:"fixed",theme:"#44bae0",show:true,trigger:"click",max:1});\' /></div><div class="menu-input menu-height menu_date"><input type="text" placeholder="请选择结束时间" id="menu_end" onclick=\'laydate.render({elem:this,type:"datetime",position:"fixed",theme:"#44bae0",show:true,trigger:"click",max:1});\' /></div><div class="menu-search menu-height zoom" id="menu_search"><input type="text" placeholder="输入关健字" id="menu_search_text" /><button type="button" id="menu_search_btn">搜索</button></div><div class="menu-list" id="menu_list"><ul></ul></div><div class="menu-btn menu-height"><button class="cbtn" id="menu_btn">确定</button></div></div>';function c(e){var i="";e.forEach(function(e,t){var n=e.code?"d-code="+e.code:"",a=e.status?" ("+e.status+")":"";i+='<li><label for="'+e.id+'" class="check"><input type="checkbox" class="menu-check" id="'+e.id+'" value='+e.id+" "+n+" /><span>"+e.name+a+"</span></label></li>"}),$("#menu_list ul").html(i)}!function(){if(o&&"object"==typeof o){for(var e in r)o.hasOwnProperty(e)||(o[e]=r[e]);if(function(){$(".menu").html(l);var e=$(window).height()-170,t=146;$(".menu-height").each(function(e){t+=$(".menu-height").eq(e).height()});var n=e-t;$(".menu-list").css("max-height",n)}(),$.trim(o.title)?($("#menu_title").show(),$("#menu_title").html(o.title)):$("#menu_title").hide(),o.search.display?($("#menu_search").show(),$("#menu_search input").val("")):$("#menu_search").hide(),0<o.list.items.length){var t=o.list;for(var e in r.list)t.hasOwnProperty(e)||(t[e]=r.list[e]);c(o.list.items)}if(o.date){var n=o.date;for(var e in r.date)n.hasOwnProperty(e)||(n[e]=r.date[e]);n.display?$(".menu_date").show():$(".menu_date").hide()}o.event.display?($("#menu_event").show(),$("#menu_event select").html('<option value="">'+o.event.title+"</option>"),$(".menu-select-title").html(o.event.title),a=o.event.options,i='<option value="">'+o.event.title+"</option>",a&&a.length&&a.forEach(function(e,t){i+='<option value="'+e.val+'">'+e.text+"</option>"}),$("#menu_event select").html(i)):($("#menu_event").hide(),$("#menu_event select").html(""))}else console.log("右侧菜单传入值有误");var a,i}(),$(document).off("click","#menu_search_btn").on("click","#menu_search_btn",function(){var n=$("#menu_search_text").val(),a=[];o.list.items.forEach(function(e,t){-1<e.name.indexOf(n)&&a.push(e)}),c(a)}),$(document).off("click",".menu-check").on("click",".menu-check",function(){$(this).is(":checked")?$(this).parent().attr("class","checked"):$(this).parent().attr("class","check")}),$(document).off("change",".menu-select").on("change",".menu-select",function(){var e=$(this).find("select").val(),t=$(this).find("select").find("option:selected").text();$(this).find(".menu-select-title").attr("d-id",e),$(this).find(".menu-select-title").html(t),e?$(this).find(".menu-select-title").removeClass("color999").addClass("color333"):$(this).find(".menu-select-title").removeClass("color999").addClass("color999")}),this.selecteds=function(){var a=[];return $(".menu-check").each(function(e,t){if($(".menu-check").eq(e).is(":checked")){var n=$(".menu-check").eq(e).val();a.push('"'+n+'"')}}),a},this.selectedsCode=function(){var a=[];return $(".menu-check").each(function(e,t){if($(".menu-check").eq(e).is(":checked")){var n=$(".menu-check").eq(e).attr("d-code");a.push('"'+n+'"')}}),a},this.selectedsText=function(){var a=[];return $(".menu-check").each(function(e,t){if($(".menu-check").eq(e).is(":checked")){var n=$(".menu-check").eq(e).next().text();a.push('"'+n+'"')}}),a}}function fn_breadcrumbs(n){if(n&&0!==n.length){$(".navBar-breadcrumbs").show();var a="";n.forEach(function(e,t){e.href=e.href?e.href:"",a+='<a class="navBar-breadcrumbs-href" d-href="'+e.href+'">'+e.name+"</a>",t!=n.length-1&&(a+="<a>></a>")}),$(".navBar-breadcrumbs-main").html(a)}else $(".navBar-breadcrumbs").hide()}function fn_warning(){function e(){$.ajax({url:ajax_106+"/get_vehicles",type:"post",dataType:"json",data:{role_id:info_login.data.roleid,extra_id:info_login.data.extraid}}).then(function(e){if("0000"===e.code){var n=[];e.data.forEach(function(e,t){n.push(e.id)});var t={vehicle_ids:n=JSON.stringify(n),last_time:window.localStorage.info_warning?window.localStorage.info_warning:""};a=t,$.ajax({url:ajax_106+"/quest_has_new_alarm",type:"post",dataType:"json",async:!1,data:a}).then(function(e){if("0000"===e.code){var t=parseInt(e.data.count),n=window.localStorage.info_warning_count?parseInt(window.localStorage.info_warning_count):0;if(window.localStorage.info_warning_count=t,n<t){var a=document.getElementById("bgMusic");a.play()}t=t<100?t:"...",$(".navBar-warning span").html(t)}})}var a})}e(),setInterval(e,5e3),$(document).off("click",".navBar-warning").on("click",".navBar-warning",function(){$(".navBar-warning span").html("0"),ajax_nav("system-warning")})}215==info_login.data.id&&(map_style="",colors_trajectory_checked=[colors_trajectory_default="#444460","#b94b5b","#ee8754"]),fun_nav_begin(),window.addEventListener("popstate",function(){ajax_nav(GetQueryString("sign")?GetQueryString("sign"):"index",!0)}),$(function(){ajax_nav(GetQueryString("sign")?GetQueryString("sign"):"index"),fn_warning(),$(document).off("mouseover",".navBar-list li a,.navBar-tab").on("mouseover",".navBar-list li a,.navBar-tab",function(){var e=$(this);if("index"!==e.attr("d-href")&&"intelligent-traffic"!==e.attr("d-href")&&($(".navBar-tab").show(),e.attr("d-child"))){var t=JSON.parse(e.attr("d-child")),n="";t.forEach(function(e,t){n+='<a class="navBar-tab-list" d-href='+e.href+"><span style='background-image:url(\"img/second/"+e.href+".png\");'>"+e.name+"</span></a>"}),$(".navBar-tab-main").attr("d-nav",e.attr("d-href")),$(".navBar-tab-main").html(n)}}),$(document).off("mouseout",".navBar-list li a,.navBar-tab").on("mouseout",".navBar-list li a,.navBar-tab",function(){$(".navBar-tab").hide()}),$(document).off("mouseover",".navBar-tab-list").on("mouseover",".navBar-tab-list",function(){$(".navBar-tab-list").removeClass("active"),$(this).addClass("active")}),$(document).off("click",".navBar-list li a").on("click",".navBar-list li a",function(){if($(".navBar-list li a").attr("class","default"),$(this).attr("class","active"),!$(this).attr("d-child")){var e=$(this).attr("d-href");clearTimer(),ajax_nav(e),clear_storage()}}),$(document).off("click",".navBar-tab-list").on("click",".navBar-tab-list",function(){ajax_nav($(this).attr("d-href"));var n=$(".navBar-tab-main").attr("d-nav");$(".navBar-list li a").attr("class","default"),$(".navBar-list li").each(function(e,t){$(".navBar-list li").eq(e).find("a").attr("d-href")===n&&$(".navBar-list li").eq(e).find("a").attr("class","active")}),clear_storage()}),$(".navBar-outlogin-title").click(function(){$(this).siblings("ul").stop(!0,!0).slideToggle()}),$("#outlogin").click(function(){ajax_logout()}),$(document).off("click",".navBar-breadcrumbs-href").on("click",".navBar-breadcrumbs-href",function(){var e=$(this).attr("d-href");e&&ajax_nav(e)})}),window.onresize=function(){$(window).width()<950&&(window.sessionStorage.sizeHtml=window.location.href,window.location.href="size.html")};