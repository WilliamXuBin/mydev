<style>
	/**加载**/
	.track-loading{margin-top:15%;}

	.danger{width:310px;box-shadow:0px 3px 6.58px 0.42px rgba(0,0,0,0.8);background-color:rgba(20,20,31,0.902);border-radius:3px;position:absolute;bottom:10px;left:10px;display:none;overflow:hidden;z-index:201;}
	.danger-info{background-color:#505873;padding:20px;}
	.danger-info-img{width:50px;height:50px;float:left;}
	.danger-info-box{width:calc(100% - 70px);height:50px;float:right;}
	.danger-info-title{width:100%;height:30px;line-height:30px;font-size:20px;color:#fff;overflow:hidden;text-overflow:ellipsis;white-space: nowrap;}
	.danger-info-content{height:20px;line-height:20px;font-size:12px;color:#fff;}
	.danger-item{padding:15px;background:url('img/danger/line.png') no-repeat;background-size:100% 1px;background-position:left bottom;}
	.danger-item:last-child{background:none;}
	.danger-item-title{}
	.danger-itemTitle-info{color:#fff;float:left;position:relative;padding-left:10px;height:20px;line-height:20px;}
	.danger-itemTitle-info:before{content:"\20";position:absolute;left:0px;top:3px;width:4px;height:14px;background:#fdca00;border-radius:3px;}
	.danger-itemTitle-txt{color:#fdca00;font-size:12px;float:right;height:20px;line-height:20px;}
	.danger-item-content{color:#fff;font-size:12px;margin-top:10px;}
	.danger-item-content ul li{height:30px;line-height:30px;position:relative;padding-left:13px;}
	.danger-item-content ul li:before{content:"\20";width:5px;height:5px;background:#7d89b2;border-radius:50%;position:absolute;top:50%;left:0px;margin-top:-2.5px;}
	.danger-itemContent-info{color:#fff;float:left;height:20px;line-height:20px;}
	.danger-itemContent-txt{color:#fdca00;font-size:12px;float:right;height:20px;line-height:20px;}
	.danger-item-msg{display:inline-block;margin-right:10px;}
	.danger-item-liLeft{float:left;}
	.danger-item-liRight1{float:right;color:#fdca00;}
	.danger-item-liRight2{float:right;color:#ccc;}

	/*.infoWindow{width:350px;background:#fff;border-radius:3px;position:relative;padding:0px 14px 16px 14px;box-shadow: 0px 4px 18.8px 1.2px rgba(0, 0, 0, 0.25);}
	.infoWindow:before{
		width: 0;
	    height: 0;
	    border-top: 20px solid white;
	    border-right: 20px solid transparent;
	    position:absolute;
	    bottom:-20px;
	    left:30px;
	    content:"\20";
	    box-shadow: 0px 4px 18.8px 1.2px rgba(0, 0, 0, 0.25);
	}
	.infoWindow-title{border-bottom:1px solid #d9d9d9;margin-bottom:12px;}
	.infoWindow-title-txt{float:left;height:36px;line-height:36px;color:#38579d;}
	.infoWindow-title-close{width:11px;height:11px;background:url('img/icon/close.png') no-repeat;background-size:100%;background-repeat:no-repeat;float:right;margin-top:11px;cursor:pointer;}
	.infoWindow-box{float:left;width:calc(100% - 120px);}
	.infoWindow-img{float:right;width:107px;height:80px;background:#000;position:relative;border-radius:5px;overflow:hidden;}
	.infoWindow-img-operation{width:100%;height:100%;position:absolute;top:0px;left:0px;z-index:1;}
	.infoWindow-img-play{background:url('img/icon/play.png') no-repeat;background-size:25px;background-position:center;}
	.infoWindow-img-timg{width:15px;height:15px;position:absolute;bottom:5px;right:5px;z-index:2;background:url('img/icon/timg.png') no-repeat;background-size:15px;display:none;}
	.infoWindow-box-title{color:#000;margin-bottom:5px;}
	.infoWindow-box-txt{color:#8a8a8c;font-size:12px;line-height:20px;}
	.infoWindow-smallView{width:40px;height:30px;background:#000;position:absolute;top:0px;right:0px;z-index:2;}
	.infoWindow-item{}
	.infoWindow-item-title{float:left;line-height:20px;}
	.infoWindow-item-content{width:calc(100% - 45px);float:left;line-height:20px;}*/

	.ctrlBlock{z-index:201;}
	.ctrlBlock-distance{margin-bottom:10px;display:none;}
	.ctrlBlock-distance-top{}
	.ctrlBlock-distance-title{float:left;color:#fff;}
	.ctrlBlock-distance-more{float:right;color:#fdca00;cursor:pointer;}
	.ctrlBlock-distance-main{text-align: center;margin:20px 0 10px 0;}
	.ctrlBlock-distance-main span{
		font-weight:bold;
		display: inline-block;
	    font-size: 30px;
	    font-family: '微软雅黑';
	    background-image: -webkit-gradient(linear, 0 0, 0 bottom, from(#fdca00), to(#4cc9ea));
	    background-image: -moz-gradient(linear, 0 0, 0 bottom, from(#fdca00), to(#4cc9ea));
	    background-image: -o-gradient(linear, 0 0, 0 bottom, from(#fdca00), to(#4cc9ea));
	    -webkit-background-clip: text;
	    -moz-background-clip: text;
	    -o-background-clip: text;
	    -webkit-text-fill-color: transparent;
	    -moz-text-fill-color: transparent;
	    -o-text-fill-color: transparent;
	    color:#fdca00;
	    text-align:center;
	}
	.ctrlBlock-main{background-color:rgba(21,21,30,0.88);box-shadow:0px 3px 6.58px 0.42px rgba(0,0,0,0.8);border-radius:3px;padding:15px 12px;}
	.ctrlBlock-title{color:#fff;border-bottom:1px dashed #4a516a;padding-bottom:12px;margin-bottom:10px;}
	.ctrlBlock-item{margin-bottom:5px;}
	.ctrlBlock-item-title{color:#fff;margin-bottom:10px;}
	.ctrlBlock-item-content{height:40px;position:relative;}
	.ctrlBlock-item-selectTitle{height:36px;line-height:36px;background-color:#e5e5e5;background-image:url("img/icon/map_downarrow.png");background-repeat:no-repeat;background-size:16px;background-position:right 10px center;border-radius:3px;color:#333;padding:0 10px;cursor:pointer;}
	.ctrlBlock-item-select{width:100%;height:36px;position:absolute;top:0px;left:0px;opacity:0;}
	.ctrlBlock-item-text{width:calc(100% - 0px);height:36px;background:#e5e5e5;color:#333;border:none;border-radius:3px;padding:0 10px;}
	.ctrlBlock-error{color:#dd183d;font-size:12px;margin-bottom:20px;}

	.ctrlBlock-ranging{display:none;}
	.ctrlBlock-ranging-top{}
	.ctrlBlock-ranging-title{float:left;color:#fff;height:30px;line-height:30px;}
	.ctrlBlock-ranging-close{float:right;color:#fff;height:30px;line-height:30px;font-size:24px;cursor:pointer;}
	.ctrlBlock-ranging-main{}
	.ctrlBlock-ranging-poit{text-align:center;margin:30px 0;}
	.ctrlBlock-ranging-poit span{width:60px;height:60px;line-height:60px;text-align:center;font-size:12px;display:inline-block;background:#fdca00;border-radius:50%;box-shadow:0 0 20px rgba(253,200,0,0.4);cursor:pointer;}
	.ctrlBlock-ranging-info{text-align:center;color:#fff;font-size:12px;}
	.ctrlBlock-ranging-info span{color:#fff;font-size:12px;}
</style>
<div id="container" tabindex="0"></div>

<div class="ctrlBlock">
	<div id="default">
		<div class="ctrlBlock-main ctrlBlock-bg">
			<div class="ctrlBlock-title">危险场景查询</div>
			<div class="ctrlBlock-item">
				<div class="ctrlBlock-item-title">车辆选择</div>
				<div class="ctrlBlock-item-content">
					<div class="ctrlBlock-item-selectTitle"></div>
					<select class="ctrlBlock-item-select" id="carsList">
						<option value="">请选择</option>
					</select>
				</div>
			</div>
			<div class="ctrlBlock-item">
				<div class="ctrlBlock-item-title">开始时间</div>
				<div class="ctrlBlock-item-content">
					<input type="text" class="ctrlBlock-item-text" d-error="请输入开始时间" placeholder="请输入开始时间" id="start" onclick="laydate.render({elem:this,type:'datetime',position:'fixed',btns:['clear', 'confirm'],format:'yyyy-MM-dd HH:mm:ss',theme:'#44bae0',show:true,trigger:'click',max:1});">
				</div>
			</div>
			<div class="ctrlBlock-item">
				<div class="ctrlBlock-item-title">结束时间</div>
				<div class="ctrlBlock-item-content">
					<input type="text" class="ctrlBlock-item-text" d-error="请输入开始时间" placeholder="请输入结束时间" id="end" onclick="laydate.render({elem:this,type:'datetime',position:'fixed',format:'yyyy-MM-dd HH:mm:ss',theme:'#44bae0',show:true,trigger:'click',max:1});">
				</div>
			</div>
			<div class="ctrlBlock-error"></div>
			<button class="cbtn" id="btn_trajectory">确定</button>
		</div>
	</div>
</div>

<div class="danger">
	<div class="danger-info zoom">
		<div class="danger-info-img">
			<img src="img/danger/warn.png" />
		</div>
		<div class="danger-info-box">
			<div class="danger-info-title" id="title"></div>
			<div class="danger-info-content" id="probability"></div>
		</div>
	</div>
	<div class="danger-item">
		<div class="danger-item-title zoom">
			<div class="danger-itemTitle-info">车辆信息</div>
		</div>
		<div class="danger-item-content zoom">
			<div class="danger-itemContent-info" id="speed">></div>
			<div class="danger-itemContent-txt" id="tip_car"></div>
		</div>
	</div>
	<div class="danger-item">
		<div class="danger-item-title zoom">
			<div class="danger-itemTitle-info">驾驶信息</div>
		</div>
		<div class="danger-item-content">
			<ul id="drive"></ul>
		</div>
	</div>
	<div class="danger-item">
		<div class="danger-item-title zoom">
			<div class="danger-itemTitle-info">环境信息</div>
			<div class="danger-itemTitle-txt" id="tip_envir"></div>
		</div>
		<div class="danger-item-content" id="envir"></div>
	</div>
	<div class="danger-item">
		<div class="danger-item-title zoom">
			<div class="danger-itemTitle-info">时间信息</div>
		</div>
		<div class="danger-item-content">
			<div class="danger-itemContent-info" id="time">></div>
			<div class="danger-itemContent-txt" id="tip_time"></div>
		</div>
	</div>
</div>
<div class="track-loading"></div>
<script type="text/javascript">
	objLoading.elem = $(".track-loading");//加载动画容器
	$(document).off("click",".ibtn-close")
	//创建地图
	var map = new AMap.Map('container', {
	    resizeEnable: true,
	    zoom:11,
	    mapStyle:map_style
	});

	//fn_breadcrumbs
	fn_breadcrumbs([
		{name:"安全中心"},
		{name:"途中危险场景",href:"dangerous-scene"},
		{name:"查看明细"},
	]);

	//ajax-获取车辆危险场景地图坐标
	function ajax_get_vehicle_dangerous_scene_map_list(set){
		$("#container").hide();
		objLoading.show();
		var sign = false;
		$.ajax({
			url:'https://api0.youbanganda.com/get_vehicle_dangerous_scene_map_list',
			type:"post",
			dataType:"json",
			data:set,
			async:false,
		}).then(function(data){
			if(data.code === "0000"){
				data = data.data;
				if(data.length>0)sign = true;
				fn_dangerous_list(data);//fn-车辆危险场景地图坐标
			}
		});
		return sign;
	}

	//fn-车辆危险场景地图坐标
	function fn_dangerous_list(items){
		if(!items || items.length===0){
			toastr.info('未查询到危险场景')//提示框
			return;
		}

		map.setCenter([items[0].gps_lon,items[0].gps_lat]);
		items.forEach(function(el,index){
			var lngLat = [el.gps_lon,el.gps_lat];

			var conf_marker = {
				name:el.insert_time,
				location:lngLat,
				offset:new AMap.Pixel(27, 25),
			};

			var _marker = map_marker(conf_marker);
			_marker.on("click",function(e){
				var postData = {
					danger_id:el.id,
					start:'',
					end:'',
				};
				ajax_get_vehicle_dangerous_scene_detail(postData);//ajax-获取车辆危险场景详情
			});
		});
	}

	//ajax-获取车辆危险场景详情
	function ajax_get_vehicle_dangerous_scene_detail(set){
		$.ajax({
			url:'https://api0.youbanganda.com/get_vehicle_dangerous_scene_detail2',
			type:'post',
			dataType:'json',
			data:set,
		}).then(function(data){
			if(data.code === "0000"){
				data = data.data;
				fn_dangerous_detail(data);//fn-获取车辆危险场景详情
			}
		});
	}

	//fn-获取车辆危险场景详情
	function fn_dangerous_detail(data){
		var config = {
			lngLat:[data.gps_lon,data.gps_lat],//坐标
			title:data.name,//危险场景名称
			time:data.time.time,//时间
			speed:data.car.speed,//当前车辆速度
			poi:data.poi,//危险场景地址
			video_url_view:data.video_url,//危险场景视频
			video_url_small:data.video_url2,//危险场景视频-小视频
			license:data.car.license,//车牌
		}
		fn_infoWindow_dangerMap(config);//加载信息载体窗口
		fn_danger(data);//危险场景显示
	}

	//危险场景显示
	function fn_danger(data){
		$(".danger").show();//显示危险场景

		$("#title").html(data.name);//危险场景名称
		$("#probability").html("事故发生概率："+data.probability);//事故发生概率：

		$("#tip_car").html(data.car.tip);
		$("#speed").html(data.car.speed);
		if(data.drive && data.drive.length>0){
			var html_drive = "";
			data.drive.forEach(function(el,index){
				if(el.tip){
					el.tip='<div class="danger-item-liRight1">'+el.tip+'</div>';
				}else{
					el.tip='<div class="danger-item-liRight2">无</div>';
				}
				html_drive += '<li class="zoom"><div class="danger-item-liLeft">'+el.name+'</div>'+el.tip+'</li>';
			});
			$("#drive").html(html_drive);
		}
		if(data.envir && data.envir.length>0){
			var html_envir = "";
			data.envir.forEach(function(el,index){
				html_envir += '<span class="danger-item-msg">'+el+'</span>';
			});
			$("#envir").html(html_envir);
		}

		if(data.time.tip)$("#tip_time").html(data.time.tip);
		$("#time").html(data.time.time);
	}

	//加载信息载体窗口
	function fn_infoWindow_dangerMap(config){
		console.log(config)
		var html = '<div class="infoWindow"><div class="infoWindow-title zoom"><div class="infoWindow-title-txt">车牌号：'+config.license+'</div><div class="infoWindow-title-close"></div></div><div class="zoom"><div class="infoWindow-box"><div class="infoWindow-item zoom"><div class="infoWindow-item-title">场景：</div><div class="infoWindow-item-content">'+config.title+'</div></div><div class="infoWindow-item zoom"><div class="infoWindow-item-title">时间：</div><div class="infoWindow-item-content">'+config.time+'</div></div><div class="infoWindow-item zoom"><div class="infoWindow-item-title">车速：</div><div class="infoWindow-item-content">'+config.speed+'</div></div><div class="infoWindow-item zoom"><div class="infoWindow-item-title">地址：</div><div class="infoWindow-item-content">'+config.poi+'</div></div></div><div class="infoWindow-img"><div class="infoWindow-view"><video id="infoWindow_video" width="107" height="80"><source src="'+config.video_url_view+'" type="video/mp4"></video></div><div class="infoWindow-img-operation infoWindow-img-play"></div><div class="infoWindow-img-timg"></div><div class="infoWindow-smallView"><video id="infoWindow_video_small" width="40" height="30"><source src="'+config.video_url_small+'" type="video/mp4"></video></div></div></div></div>';
		var obj = {
			width:50,
			title:"车牌号："+config.license,
			type:"video",
			items:[
				{title:"场景：",content:config.title},
				{title:"时间：",content:config.time},
				{title:"车速：",content:config.speed},
				{title:"地址：",content:config.poi},
			],
			info:{
				video_url_view:config.video_url_view,
				video_url_small:config.video_url_small
			}
		};
		var infoWindow = new AMap.InfoWindow({
		    isCustom: true,  //使用自定义窗体
		    content: ret_infoWindow(obj),
		    offset: new AMap.Pixel(0, -70)//
		});
		infoWindow.open(map, config.lngLat);
	}

	var info_dangerMap;
	if(window.sessionStorage.info_dangerMap){
		info_dangerMap = JSON.parse(window.sessionStorage.info_dangerMap);
		ajax_get_vehicle_dangerous_scene_map_list(info_dangerMap);//获取车辆危险场景地图坐标
		btn_disable();//按钮不可用
	}

	//按钮不可用
	function btn_disable(){
		//恢复点击
		$("#btn_trajectory").removeClass("btn-orange").addClass("btn-gray");
		$("#btn_trajectory").attr("disabled","disabled");
		$("#btn_trajectory").html("查询中");
		$("#container").hide();
		objLoading.show();
	}

	//按钮可用
	function btn_defalut(){
		//恢复点击
		$("#btn_trajectory").removeClass("btn-gray").addClass("btn-orange");
		$("#btn_trajectory").removeAttr("disabled");
		$("#btn_trajectory").html("确定");
		$("#container").show();
		objLoading.hide();
	}

	//输入框内容改变
	$(document).off("change","#carsList").on("change","#carsList",function(){
		var sel_txt = $(this).find("option:selected").text();
		$(".ctrlBlock-item-selectTitle").html(sel_txt);
	});

	//ajax-getCarsList
	function ajax_get_vehicles(data){
		$.ajax({
			url:ajax_106+'/get_vehicles',
			type:'post',
			dataType:'json',
			async:false,
			data:{
				role_id:data.role_id,
				extra_id:data.extra_id,
			}
		}).then(function(data){
			if(data.code === "0000"){
				fn_getCarsList(data.data);//fn-getCarsList
			}
		});
	}
	var postData = {
		role_id:info_login.data.roleid,
		extra_id:info_login.data.extraid,
	};
	ajax_get_vehicles(postData);

	//fn-getCarsList
	function fn_getCarsList(items){
		if(!items && items.length===0)return false;

		var html = '';
		items.forEach(function(el,index){
			html += '<option value='+el.id+'><font><font>'+el.name+'</font></font></option>';
		});
		$("#carsList").html(html);
		//判断是否有默认值
		if(window.sessionStorage.info_dangerMap){
			info_dangerMap = JSON.parse(window.sessionStorage.info_dangerMap);
			$("#carsList").val(info_dangerMap.vehicle_id);
			$("#start").val(info_dangerMap.start);
			$("#end").val(info_dangerMap.end);
		}
		$("#carsList").change();
	}

	//加载PathSimplifier，loadUI的路径参数为模块名中 'ui/' 之后的部分 
	AMapUI.load(['ui/misc/PathSimplifier'], function(PathSimplifier) {

	    if (!PathSimplifier.supportCanvas) {
	        alert('当前环境不支持 Canvas！');
	        return;
	    }

	    //启动页面
	    initPage(PathSimplifier);
	});

	function initPage(PathSimplifier) {
	    //创建组件实例
	    var pathSimplifierIns = new PathSimplifier({
	        zIndex: 100,
	        map: map, //所属的地图实例
	        getPath: function(pathData, pathIndex) {
	            //返回轨迹数据中的节点坐标信息，[AMap.LngLat, AMap.LngLat...] 或者 [[lng|number,lat|number],...]
	            return pathData.path;
	        },
	        getHoverTitle: function(pathData, pathIndex, pointIndex) {
	            //返回鼠标悬停时显示的信息
	            if (pointIndex >= 0) {
	                //鼠标悬停在某个轨迹节点上
	                //return pathData.name + '，点:' + pointIndex + '/' + pathData.path.length;
	            }
	            //鼠标悬停在节点之间的连线上
	            //return pathData.name + '，点数量' + pathData.path.length;
	        },
	        renderOptions: {
	            //轨迹线的样式
	            pathLineStyle: {
	                strokeStyle: colors_trajectory_default,
	                lineWidth: width_trajectory,
	                dirArrowStyle: true
	            },
	            pathLineHoverStyle:{//鼠标经过
	            	strokeStyle: colors_trajectory_default,
	            },
	            pathLineSelectedStyle: {//线被选中
                	strokeStyle: colors_trajectory_default,
                },
	        }
	    });

	    //按钮点击
	    $(document).off("click","#btn_trajectory").on("click","#btn_trajectory",function(){
	    	var vehicle_id = $("#carsList").val();//获取车辆
	    	var startTime = $("#start").val();//获取开始时间
	    	var endTime = $("#end").val();//获取结束

	    	if(!startTime)startTime=-1;
	    	if(!endTime)endTime=-1;

	    	$(".ctrlBlock-error").html("");
	    	if(startTime === -1){
	    		$(".ctrlBlock-error").html('请选择开始时间');//提示框
	    		return false;
	    	}

	    	if(endTime === -1){
    			$(".ctrlBlock-error").html('请选择结束时间');//提示框
    			return false;
	    	}

	    	if(startTime >= endTime){
	    		$(".ctrlBlock-error").html('开始时间不能大于等结束时间！');//提示框
	    		return false;
	    	}

	    	//if(!daysMath({start:startTime,end:endTime}))return;

	    	btn_disable();//按钮不可用

	    	var ver = $(".verification");
	    	var len = ver.length;
	    	for(var i=0;i<len;i++){
	    		var tagName = ver.eq(i).tagName;
	    		var info_err = ver.eq(i).attr("d-error");
	    		if(tagName === "SELECT" && !ver.eq(i).val()){
	    			$(".ctrlBlock-error").html(info_err);
	    			btn_defalut();//按钮可用
	    			return false;
	    		}else if(tagName === "INPUT" && !ver.eq(i).val()){
	    			$(".ctrlBlock-error").html(info_err);
	    			btn_defalut();//按钮可用
	    			return false;
	    		}
	    	}
	    	$(".ctrlBlock-error").html("");
	    	$(".danger").hide();
	    	map.clearInfoWindow();
			map.clearMap();

	    	var data = {
				vehicle_id:vehicle_id,
				start:startTime,
				end:endTime,
			};

			//获取车辆危险场景地图坐标
			if(!ajax_get_vehicle_dangerous_scene_map_list(data)){
				btn_defalut();//按钮可用
				fn_get_vehicle_trails(false);
				return;
			}

			ajax_get_vehicle_trails(data);//ajax-the car position
			
	    });

	    var path_add_arr = [];
	    var path_old_arr = [];

		//ajax-the car position
		function ajax_get_vehicle_trails(set){
			btn_defalut();
			$("#container").hide();
			objLoading.show();
			$.ajax({
				url:ajax_106+'/get_vehicle_addpoint_trails_test',
				type:'post',
				dataType:'json',
				data:{
					vehicle_id:set.vehicle_id,
					start:set.start,
					end:set.end,
				},
			}).then(function(data){
				btn_defalut();//按钮可用
				$(".loading_track").remove();
				if(data.code === "0000"){
					path = data.data;
					fn_get_vehicle_trails(path);
				}else{
					pathSimplifierIns.setData([]);
					//map.clearMap();
					fn_get_vehicle_trails(false);
				}
			});
		}

		//fn_get_vehicle_trails
		function fn_get_vehicle_trails(path){
			if(!path || path.length===0){
				pathSimplifierIns.setData([]);
				btn_defalut();//按钮可用
				return;
			}

			var conf_begin = {
				name:"起点",//名称+
				location:path[0].path[path[0].path.length-1],//经纬度
				title:"起点",//地标名
				offset:new AMap.Pixel(4, 25),
				bg:"blue"
			};
			map_marker(conf_begin);

			var conf_end = {
				name:"终点",//名称+
				location:path[0].path[0],//经纬度
				title:"终点",//地标名
				offset:new AMap.Pixel(4, 25),
				bg:"blue"
			};
			map_marker(conf_end);

	    	pathSimplifierIns.setData(path);
		}

		if(info_dangerMap)ajax_get_vehicle_trails(info_dangerMap);//ajax-the car position
	}

	//点击开播放暂停
	$(document).off("click",".infoWindow-img-operation").on("click",".infoWindow-img-operation",function(){
		var infoWindow_video = document.getElementById("infoWindow_video");
		var infoWindow_video_small = document.getElementById("infoWindow_video_small");
		var _this = $(this);

		if(infoWindow_video.paused){
			_this.removeClass("infoWindow-img-play");
			_this.siblings(".infoWindow-img-timg").show();
		  	infoWindow_video.play();
		  	infoWindow_video_small.play();
		}else{
			_this.addClass("infoWindow-img-play");
			_this.siblings(".infoWindow-img-timg").hide();
		  	infoWindow_video.pause();
		  	infoWindow_video_small.pause();
		}
		infoWindow_video.addEventListener("ended",function(){
	        _this.addClass("infoWindow-img-play");
			_this.siblings(".infoWindow-img-timg").hide();
			infoWindow_video_small.pause();
	    })
	});

	$(document).off("click","#infoWindow_video_small").on("click","#infoWindow_video_small",function(){
		var src_small = $("#infoWindow_video_small").find("source").attr("src");
		var src_view = $("#infoWindow_video").find("source").attr("src");

		var html_view = '<video id="infoWindow_video" width="107" height="80"><source src="'+src_small+'" type="video/mp4"></video>';
		$(".infoWindow-view").html(html_view);

		var html_small = '<video id="infoWindow_video_small" width="40" height="30"><source src="'+src_view+'" type="video/mp4"></video>';
		$(".infoWindow-smallView").html(html_small);

		$(".infoWindow-img-operation").addClass("infoWindow-img-play");
		$(".infoWindow-img-operation").siblings(".infoWindow-img-timg").hide();
	});

	//点击进入全屏
	$(document).off("click",".infoWindow-img-timg").on("click",".infoWindow-img-timg",function(){
		var de = document.getElementById("infoWindow_video");
		if(de.requestFullscreen){
	        de.requestFullscreen();
	    }else if(de.mozRequestFullScreen) {
	        de.mozRequestFullScreen();
	    }else if(de.webkitRequestFullScreen) {
	        de.webkitRequestFullScreen();
	    }else if(de.msRequestFullscreen){ 
			de.msRequestFullscreen(); 
		}else if(de.oRequestFullscreen){
			de.oRequestFullscreen();
	    }
	});

	//点击关闭小窗体
	$(document).off("click",".infoWindow-title-close").on("click",".infoWindow-title-close",function(){
		map.clearInfoWindow();
		$(".danger").hide();
	});

	fn_size_window();//窗体大小
</script>